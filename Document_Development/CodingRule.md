# AltseedのC++コーディング規約

## ファイルとディレクトリ
### ファイル名
ソースファイルのファイル名はasd.○○.h / asd.○○.cppとする。これは外部のアーカイブとリンクした時に、オブジェクト名が衝突するのを防ぐため。

### ディレクトリ構造
今回の開発は非常にファイルが増えると予想されるため、最低でもおおまかな区分けでディレクトリを分離する。1つのクラスが多数のプラットフォームに分岐する場合、クラス単位でディレクトリを分離する。Visual Studio上のC++プロジェクトではディレクトリではなく「フィルター」で分けて表示されるが、フィルターの構造はディレクトリと同じ構成にする。また、ディレクトリ名は先頭大文字を推奨する。

### ファイルの文字コード
utf8BOM付とする。なお、cp932で記述したとしてもswigのスクリプト実行時に自動的にutf8BOM付に変換される。

## コードの書き方
### 名前空間
全て、asd直下とする。これはSWIGがネームスペースを無視する影響で他の言語に移植する際に問題が出にくくするためである。

## include
すべての区切り文字は/とする。これは\だとgccでコンパイルできないからである。また、limits.hやstring.hでなく、先頭にcをつけ、.hを抜かしたclimits, cstring等を使用する。こちらはC++固有の機能を用いた最適化や安全策を設けている場合がある。

### 継承されるクラスについて
必ず、継承されるクラスは仮想デストラクタを設ける。仮想デストラクタを持たないクラスを基底クラスにすると、派生クラスのデストラクタしか呼ばれず、見つけにくいメモリリークを引き起こす。仮想デストラクタを持たないクラスは継承しないようにすべき。

### クラス内のstatic関数
不必要なケースを除き、クラス内にstatic関数を用意するのではなく、汎用化して関数として使用できるようにする。

### 構造体の参照
プリミティブな構造体を参照を渡すために引数に取る場合、無効を表すケースを除いてポインタではなく参照を渡すようにする。渡した参照元が先に消えるような設計にはそもそもしないようにする。

### 命名規則
* CamelCase
クラス名は先頭大文字
```
TextureObject2D
```

プライベートや引数は先頭小文字
```
textureObject2D
```

* Is◯◯
C++では、GetIs◯◯、SetIs◯◯とする。C#では、対応する関数をプロパティで実装する。

### ダウンキャスト
ダウンキャストをする際、結果が明らかでない場合はASSERT_STATIC_CASTというマクロを使用してキャストが成功するか確認する。
キャストできない場合、dynamic_castが必要な場合は警告を発生させる。

```
ASSERT_STATIC_CAST(Renderer2D_Imp*, renderer);
m_renderer = (Renderer2D_Imp*)renderer;
```

### const修飾について
const修飾については、以下のルールになるべく従うようにする。

 - 定数には **必ず** constをつける。defineで定数宣言は絶対にしないこと。constexpr
   はMSVCの対応が不十分なので、しばらくは使わないこと。
 - Getterなど、そのクラスのメンバ変数を書き換えないメンバ関数はconst修飾する。
 - 関数内で書き換えないポインタや参照型の引数はconst修飾する。逆に、
   const修飾されていないポインタやスマートポインタ、参照型の引数は、状態を変化
   させたり値を返したりするのに使われるという表明に使う。
   値渡しの引数にもconstをつけるよう統一するのもいい習慣である。
 - ポインタやスマートポインタ、参照の返値のうち、ユーザに変更してほしくない物には
   const修飾して意思を明確に伝えるようにする。数値型など、参照やポインタでない
   返値にconst修飾するのは意味がない(逆に効率を下げる場合すらある)ので
   気をつけること。
 - 再代入されない一時変数にはconstをつけた方がよい。

### enum
enum classを使用する。その際、必ず型のサイズを指定する。

### その他
* 関数などにDoxygenに対応したコメントを付ける。
* はじめ波括弧({)は、下げる。
* インデントはハードタブとする。

## ライブラリや新機能の利用

### C++11, C++14
gcc4.7、clang3.2、msvc2013全てでサポートされている文法は使用可能。ライブラリはNDKとiPhoneの更新具合に依存する。

### クラスの内側で定義したクラステンプレートの特殊化
クラスの内側で定義したクラステンプレートを特殊化は禁止する。[詳細はこちらを参照のこと。](http://d.hatena.ne.jp/matsutakegohan1/20071001/1191245392)実はVisualStudio独自の拡張なので使用してはいけない。
